# 検索結果ページ エリア選択UI改修 - 実装計画

## 概要

検索結果ページのエリア選択UIをTOPページと同じ段階的データ取得方式に統一します。
現在、検索結果ページでは旧実装が残存しており、不要な全件取得が発生しています。

**背景**:

- TOPページは段階的データ取得方式に移行済み（コミット: 69d6b52, 365f58c）
- 検索結果ページは旧実装のまま（useMiddleAreas・useSmallAreasを引数なしで呼び出し）
- アーキテクチャの一貫性と保守性向上のため、統一が必要

## 現状の問題点

検索結果ページ（`app/pages/shops/index.vue`）で以下の問題があります:

1. **不要な全件取得**
   - `useMiddleAreas()`・`useSmallAreas()`を引数なしで呼び出し
   - 初期ロード時に不要なAPIリクエストが発生（空配列が返る）

2. **不要なprops渡し**
   - `SearchForm`に`middle-areas`・`small-areas` propsを渡している
   - SearchForm.vueは既にこれらのpropsを受け取らない設計

3. **ローディング・エラー状態の不整合**
   - 中エリア・小エリアのローディング・エラー状態が含まれている
   - 実際には使用されていない

**機能的影響**: なし（SearchForm内部で段階的取得が動作するため検索は正常）

## 修正内容

### 対象ファイル

**app/pages/shops/index.vue** のみ

### 修正箇所

#### 1. useMiddleAreas・useSmallAreas呼び出しを削除（L23-37）

```diff
- const {
-   areas: middleAreas,
-   isLoading: isLoadingMiddleAreas,
-   apiError: middleAreasError,
-   errorMessage: middleAreasErrorMessage,
-   refresh: refreshMiddleAreas,
- } = useMiddleAreas()
-
- const {
-   areas: smallAreas,
-   isLoading: isLoadingSmallAreas,
-   apiError: smallAreasError,
-   errorMessage: smallAreasErrorMessage,
-   refresh: refreshSmallAreas,
- } = useSmallAreas()
```

#### 2. ローディング・エラー状態の統合を修正（L40-76）

```diff
 const isLoadingMasters = computed(
   () =>
     isLoadingGenres.value ||
-    isLoadingLargeAreas.value ||
-    isLoadingMiddleAreas.value ||
-    isLoadingSmallAreas.value,
+    isLoadingLargeAreas.value,
 )

 const mastersError = computed(() => {
-  return (
-    genresError.value || largeAreasError.value || middleAreasError.value || smallAreasError.value
-  )
+  return genresError.value || largeAreasError.value
 })

 const mastersErrorMessage = computed(() => {
-  const errors = [
-    genresErrorMessage.value,
-    largeAreasErrorMessage.value,
-    middleAreasErrorMessage.value,
-    smallAreasErrorMessage.value,
-  ].filter(Boolean)
+  const errors = [genresErrorMessage.value, largeAreasErrorMessage.value].filter(Boolean)

   // ... 後続処理は変更なし
 })

 const retryLoadMasters = async () => {
-  await Promise.all([
-    refreshGenres(),
-    refreshLargeAreas(),
-    refreshMiddleAreas(),
-    refreshSmallAreas(),
-  ])
+  await Promise.all([refreshGenres(), refreshLargeAreas()])
 }
```

#### 3. SearchFormへのprops削除（L250-256）

```diff
 <SearchForm
   v-else
   :genres="genres"
   :large-areas="largeAreas"
-  :middle-areas="middleAreas"
-  :small-areas="smallAreas"
 />
```

## 完了条件

- [ ] `app/pages/shops/index.vue`の3箇所を修正
- [ ] `yarn type-check`が成功する
- [ ] `yarn lint`が成功する
- [ ] 開発サーバーで検索結果ページが正常に動作する
  - [ ] 検索フォームが正しく表示される
  - [ ] エリア選択が段階的に動作する（大エリア選択→中エリア取得→小エリア取得）
  - [ ] 検索実行が正常に動作する
  - [ ] マスタデータのエラー処理が正しく動作する

## 期待される効果

1. **アーキテクチャの一貫性**: TOPページと検索結果ページでデータ取得方式が統一される
2. **パフォーマンス向上**: 不要なAPIリクエストが削減される
3. **保守性向上**: コードがシンプルになり、将来の変更が容易になる

## 参考

- 関連コミット:
  - `69d6b52`: TOPページエリア選択UIを段階的データ取得方式に改修
  - `365f58c`: エリア選択から一次変数を削除してシンプル化
- 関連ドキュメント: `docs/実装計画/3.4_TOPページエリア選択UI改修計画.md`
