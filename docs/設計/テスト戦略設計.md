## 目的

主要機能（検索 → 一覧/地図 → 詳細表示）が、ユーザー操作に対して期待どおりに動作することを確認する。  
実装の詳細はテスト対象にせず、ユーザー操作視点での挙動のみ検証する。

---

## 方針

- **E2Eテストは実施しない。**
- DOM・UIの状態変化を確認し、内部処理のロジックや実装詳細は対象外とする。
- APIの実呼び出しは行わず、**モックデータで動作を固定**してテストする。

---

## テストレベルと範囲

| レベル     | 主な対象                                   | 検証内容                                                   |
| ---------- | ------------------------------------------ | ---------------------------------------------------------- |
| 単体テスト | コンポーネント、Composable、ユーティリティ | 表示条件・入力・バリデーション・アクセシビリティ属性の有無 |
| 結合テスト | 内部API呼び出し～画面反映                  | API応答に応じた状態切替（読み込み中／0件／エラー／正常）   |

---

## テスト環境

- **フレームワーク**: Nuxt 4
- **テストランナー**: Vitest (v3.2.4)
- **テストユーティリティ**: @nuxt/test-utils (v3.20.1)
- **コンポーネントテスト**: @vue/test-utils (v2.4.6)
- **DOM環境**: happy-dom (v20.0.10)
- **APIモック**: MSW (v2.11.6)
- **実行環境**: Node.js 22系（ローカル／CI共通）

---

## テストデータ

- 内部API(`/api/hp/*`) をモック化。
- 代表ケース（正常／0件／エラー）を固定レスポンスで用意。
- HotPepper API への外部通信は行わない。

---

## 実施タイミング

| フェーズ     | 主な実施内容                                             |
| ------------ | -------------------------------------------------------- |
| モック開発時 | コンポーネント単体テスト（表示・操作・アクセシビリティ） |
| API結合時    | 結合テスト（読み込み中／0件／エラー／正常）              |
| リリース前   | 主要フローの通し確認（結合テスト再実行）                 |

---

## テストすべき項目・すべきでない項目

### ✅ テストすべき項目

**コンポーネント単体テスト：**

- **表示条件**: `v-if`、`v-show` による条件分岐
- **入力・バリデーション**: フォーム入力、エラー表示、入力制限
- **アクセシビリティ属性**: `aria-label`、`role`、`alt` など
- **ユーザー操作**: ボタンクリック、入力イベントによる状態変化
- **Props による表示切替**: Props の値によって表示内容が変わる場合

**結合テスト（API）：**

- **ステータスコード**: 200/400/404/502 などの正しいレスポンス
- **エラーハンドリング**: エラー時の適切な処理
- **バリデーションエラー**: 必須パラメータ未指定時の挙動
- **0 件レスポンス**: データが空の場合の挙動
- **API 応答による状態遷移**: 読み込み中 → 正常/エラー/0 件

### ❌ テストすべきでない項目

**実装の詳細：**

- **HTML 構造**: `<div>` や `<span>` の階層、class 名の有無
- **CSS class 名**: Tailwind のユーティリティクラス名
- **内部の変換ロジック**: トリム、正規化、フォーマット処理
- **ユーティリティ関数の内部動作**: 文字列操作、データ変換の詳細
- **モックの呼び出し引数**: モック関数が正しい引数で呼ばれたか
- **コンポーネントの内部状態**: `ref`、`reactive` の値の変化（外部に影響しない場合）

**フレームワークの責任範囲：**

- **ルーティング**: `NuxtLink` の `href` 属性（Nuxt の責任）
- **Vue の機能**: `v-model` のバインディング（Vue の責任）

**インフラコード：**

- **ログ出力**: ログフォーマット、ログレベルフィルタリング
- **設定値の解析**: 環境変数のパース、デフォルト値の解決

### 判断基準

**テストを書く前に自問：**

1. **ユーザーに影響するか？** → Yes ならテスト、No なら不要
2. **実装を変更しても同じテストが通るか？** → Yes ならテスト、No なら過剰
3. **フレームワークやライブラリの責任か？** → Yes なら不要、No ならテスト

**具体例：**

```typescript
// ✅ 良いテスト（ユーザーに影響する挙動）
expect(wrapper.find('button').attributes('disabled')).toBe('true') // ボタンが無効化される
expect(wrapper.text()).toContain('エラーが発生しました') // エラーメッセージが表示される

// ❌ 悪いテスト（実装の詳細）
expect(wrapper.find('.flex.items-center').exists()).toBe(true) // CSS class名
expect(mockFunction).toHaveBeenCalledWith('trimmed') // モックの引数
expect(wrapper.vm.internalState).toBe('loading') // 内部状態（外部に影響しない）
```
